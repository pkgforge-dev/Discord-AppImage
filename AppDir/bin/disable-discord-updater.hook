#!/bin/sh

f=${XDG_CONFIG_HOME:-$HOME/.config}/discord/settings.json

for d in jq grep mkdir; do
	command -v "$d" 1>/dev/null || exit 0 # do not stop discord from launching
done

if [ ! -f "$f" ]; then
	mkdir -p "${f%/*}"
	echo "{}" > "$f"
fi

if ! grep -q 'SKIP_HOST_UPDATE' "$f" \
  && _f=$(jq '.SKIP_HOST_UPDATE = true' "$f"); then
	echo "$_f" > "$f"
	>&2 echo "Added 'SKIP_HOST_UPDATE = true' to $f"
fi
